import 'net.http'
import 'std.fs'

// –°–ª–æ–≤–∞—Ä—å –¥–∞–Ω–Ω—ã—Ö üå±
data := {
	'index': fs.read_text(fs.path_of('./home.html')),
	'js': fs.read_text(fs.path_of('./js/prism-watt.js')),
	'style': fs.read_text(fs.path_of('./style/style.css')),
	'lamp': fs.read_bytes(fs.path_of('./lamp.png'))
}

// –°–µ—Ä–≤–µ—Ä üßä
app := new HttpServer(1080)

// –§–∞–π–ª—ã
app.get('/internal/js', fun(ctx) {
    ctx.contentType('text/js')
    ctx.result(data.get('js'))	
})
app.get('/internal/style', fun(ctx) {
    ctx.contentType('text/css')
    ctx.result(data.get('style'))	
})
app.get('/internal/lamp', fun(ctx) {
    ctx.contentType('image/png')
    ctx.result(data.get('lamp'))	
})

// –°—Ç—Ä–∞–Ω–∏—á–∫–∏ ü§´
app.get('/index', fun(ctx) {
    ctx.contentType('text/html; charset=UTF-8')
    ctx.result(data.get('index'))
})
app.on_error(404, fun(ctx) {
    ctx.json('Not found.')
})

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.run()